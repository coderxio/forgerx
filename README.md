# Medication Diversification Tool

The Medication Diversification Tool (MDT) leverages publicly-available, government-maintained datasets to enhance [Synthea’s Synthetic Patient Generator](https://github.com/synthetichealth/synthea). The synthetic health data generated by Synthea can be used by researchers, software developers, policymakers, and clinicians to develop healthcare solutions. In its current state, the process for generating medications in Synthea is manual and limited to a small selection of medications in individual modules. The goal for the MDT is to create more diverse synthetic patient medication orders that accurately reflects the heterogeneity of medications being prescribed in the US population.

The MDT automates the process for finding relevant medication codes and calculating a distribution of medications, using medication classification dictionaries from RxClass and population-level prescription data from the Medical Expenditure Panel Survey (MEPS). The medication distributions can be tailored to specific patient demographics (e.g., age, gender, state of residence) and combined with Synthea data to generate medication records for a sample patient population.


## How to replace a MedicationOrder with a MDT submodule
To replace a MedicationOrder with one of our MDT submodules, replace the [MedicationOrder state](https://github.com/synthetichealth/synthea/wiki/Generic-Module-Framework:-States#medicationorder) with a [CallSubmodule state](https://github.com/synthetichealth/synthea/wiki/Generic-Module-Framework%3A-States#callsubmodule).

```
"Medication_Submodule": {
  "type": "CallSubmodule",
  "submodule": "medications/<<name_of_your_mdt_submodule_here_without_json_file_extension>>"
}
```

Put the submodule JSON file in the [`/src/main/resources/modules/medications`](https://github.com/synthetichealth/synthea/tree/master/src/main/resources/modules/medications) folder.

Put your transition table CSV files in the [`/src/main/resources/modules/lookup_tables`](https://github.com/synthetichealth/synthea/tree/master/src/main/resources/modules/lookup_tables) folder.

**Example for hypothyroidism module:**

Using the existing [hypothyroidism module](https://github.com/synthetichealth/synthea/blob/master/src/main/resources/modules/hypothyroidism.json) as an example...

Change this...

```
    "Synthroid Medication Order": {
      "type": "MedicationOrder",
      "codes": [
        {
          "system": "RxNorm",
          "code": 966222,
          "display": "Levothyroxine Sodium 0.075 MG Oral Tablet"
        }
      ],
      "direct_transition": "end encounter",
      "prescription": {
        "dosage": {
          "amount": 1,
          "frequency": 1,
          "period": 60,
          "unit": "days"
        },
        "duration": {
          "quantity": 60,
          "unit": "days"
        },
        "refills": 6
      }
    },
```

To this...

```
    "Synthroid Medication Order": {
      "type": "CallSubmodule",
      "submodule": "medications/hypothyroidism_medication",
      "direct_transition": "end encounter"
    },
```

And make sure your submodule JSON and transition table CSVs are in the folder locations specified above.
* Put a `hypothyroidism_medication.json` file in the `/src/main/resources/modules/medication` folder
* Put all the transition table CSV files in the `/src/main/resources/modules/lookup_tables` folder

See below for example file structure:

```
src/
├─ main/
│  ├─ resources/
│  │  ├─ modules/
│  │  │  ├─ medication/
│  │  │  │  ├─ hypothyroidism_medication.json
│  │  │  │  ├─ ...
│  │  │  ├─ lookup_tables/
│  │  │  │  ├─ Hypothyroidism_ingredient_distrib.csv
│  │  │  │  ├─ Hypothyroidism_product_levothyroxine_distrib.csv
│  │  │  │  ├─ Hypothyroidism_product_liothyronine_distrib.csv
│  │  │  │  ├─ Hypothyroidism_product_thyroid_USP_distrib.csv
│  │  │  │  ├─ ...
│  │  │  ├─ hypothyroidism.json
│  │  │  ├─ ...
```
